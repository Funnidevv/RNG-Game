<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>RNG Game</title>
<style>
  body {
    background: #121212;
    color: #eee;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    margin: 0; padding: 0;
    display: flex; flex-direction: column; align-items: center;
    min-height: 100vh;
  }
  header {
    padding: 1rem;
    font-size: 2rem;
    font-weight: bold;
    user-select: none;
  }
  main {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 1rem;
    max-width: 1200px;
    width: 100%;
    padding: 1rem;
  }
  section {
    background: #222;
    border-radius: 8px;
    padding: 1rem;
    flex: 1 1 300px;
    max-width: 400px;
    box-sizing: border-box;
  }
  h2 {
    margin-top: 0;
    margin-bottom: 0.5rem;
  }
  button {
    background: #3a86ff;
    border: none;
    padding: 0.6rem 1rem;
    border-radius: 4px;
    color: white;
    font-weight: bold;
    cursor: pointer;
    user-select: none;
    transition: background-color 0.2s ease;
  }
  button:disabled {
    background: #555;
    cursor: not-allowed;
  }
  button:hover:not(:disabled) {
    background: #265fca;
  }
  ul {
    list-style: none;
    padding-left: 0;
    max-height: 300px;
    overflow-y: auto;
  }
  li {
    padding: 0.3rem 0.4rem;
    border-bottom: 1px solid #444;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }
  label.inventory-item-label {
    flex: 1;
    user-select: none;
  }
  input[type="checkbox"] {
    width: 18px;
    height: 18px;
  }
  .aura-display {
    text-align: center;
    font-size: 1.7rem;
    font-weight: 900;
    margin-bottom: 0.3rem;
    padding: 0.8rem;
    border-radius: 10px;
    box-shadow: 0 0 10px #444;
    user-select: none;
  }
  .aura-category {
    text-align: center;
    font-weight: bold;
    font-size: 1.2rem;
    margin-bottom: 1rem;
    user-select: none;
  }
  /* Category colors */
  .category-common {
    color: #a0a0a0;
    text-shadow: 0 0 4px #6f6f6f;
  }
  .category-rare {
    color: #4db8ff;
    text-shadow: 0 0 10px #00aaff;
  }
  .category-epic {
    color: #b347ff;
    text-shadow: 0 0 15px #9a00ff;
  }
  .category-legendary {
    color: #ffae42;
    text-shadow: 0 0 15px #ff8300;
  }
  .category-mythic {
    color: #ff4d4d;
    text-shadow: 0 0 20px #ff0000;
  }
  .shop-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0.4rem 0;
  }
  .coins-display {
    font-size: 1.5rem;
    font-weight: bold;
    margin-bottom: 1rem;
    user-select: none;
    text-align: center;
  }
  .leaderboard-inputs {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 0.5rem;
  }
  input[type="text"] {
    flex: 1;
    padding: 0.4rem 0.6rem;
    border-radius: 4px;
    border: none;
    font-size: 1rem;
  }
  /* Scrollbar styling for lists */
  ul::-webkit-scrollbar {
    width: 8px;
  }
  ul::-webkit-scrollbar-thumb {
    background: #444;
    border-radius: 4px;
  }
  ul::-webkit-scrollbar-track {
    background: #222;
  }
</style>
</head>
<body>

<header>RNG Game</header>

<main>

  <section id="roll-section">
    <h2>Roll</h2>
    <div class="aura-display" id="aura-display">-</div>
    <div class="aura-category" id="aura-category"></div>
    <button id="roll-btn">Roll</button>
  </section>

  <section id="inventory-section">
    <h2>Inventory</h2>
    <ul id="inventory-list"><li style="text-align:center; color:#bbb;">No auras collected yet.</li></ul>
    <button id="sell-selected-btn" disabled>Sell Selected</button>
  </section>

  <section id="shop-section">
    <h2>Shop</h2>
    <div class="coins-display" id="coins-display">Coins: 0</div>
    <ul id="shop-list"></ul>
  </section>

  <section id="leaderboard-section">
    <h2>Leaderboard</h2>
    <div class="leaderboard-inputs">
      <input type="text" id="player-name-input" placeholder="Enter your name" maxlength="20" />
      <button id="save-score-btn" disabled>Save Score</button>
    </div>
    <ul id="leaderboard-list"><li style="text-align:center; color:#bbb;">No scores yet.</li></ul>
  </section>

</main>

<script>
(() => {
  // Categories with base weight (rarity) and base price
  const CATEGORIES = [
    { name: 'Common', baseWeight: 50, basePrice: 10, idMin: 1, idMax: 40000 },
    { name: 'Rare', baseWeight: 25, basePrice: 50, idMin: 40001, idMax: 70000 },
    { name: 'Epic', baseWeight: 15, basePrice: 150, idMin: 70001, idMax: 90000 },
    { name: 'Legendary', baseWeight: 8, basePrice: 500, idMin: 90001, idMax: 98000 },
    { name: 'Mythic', baseWeight: 2, basePrice: 1500, idMin: 98001, idMax: 100000 }
  ];

  // Procedurally generate aura by id
  function generateAura(id) {
    // Find category based on id range
    let categoryObj = CATEGORIES.find(cat => id >= cat.idMin && id <= cat.idMax);
    if (!categoryObj) categoryObj = CATEGORIES[0]; // fallback Common

    // Name format: "<Category> Aura #<id>"
    const name = `${categoryObj.name} Aura #${id}`;

    // Deterministic price based on id (to keep consistent across loads)
    const basePrice = categoryObj.basePrice;
    const price = basePrice + (id % basePrice);

    return { name, category: categoryObj.name, basePrice: price, weight: categoryObj.baseWeight };
  }

  // Parse aura name to regenerate aura object
  function getAuraByName(name) {
    const match = name.match(/^(Common|Rare|Epic|Legendary|Mythic) Aura #(\d+)$/);
    if (!match) return null;
    const categoryName = match[1];
    const id = parseInt(match[2], 10);
    return generateAura(id);
  }

  // Weighted random aura roll
  function weightedRandomAura() {
    const totalWeight = CATEGORIES.reduce((sum, c) => sum + c.baseWeight, 0);
    let rand = Math.random() * totalWeight;
    let category = CATEGORIES[0];
    for (const c of CATEGORIES) {
      if (rand < c.baseWeight) {
        category = c;
        break;
      }
      rand -= c.baseWeight;
    }

    // Random ID in category range
    const id = Math.floor(Math.random() * (category.idMax - category.idMin + 1)) + category.idMin;

    return generateAura(id);
  }

  // UI Elements
  const rollBtn = document.getElementById('roll-btn');
  const auraDisplay = document.getElementById('aura-display');
  const auraCategoryEl = document.getElementById('aura-category');
  const inventoryList = document.getElementById('inventory-list');
  const sellSelectedBtn = document.getElementById('sell-selected-btn');
  const coinsDisplay = document.getElementById('coins-display');
  const shopList = document.getElementById('shop-list');
  const leaderboardList = document.getElementById('leaderboard-list');
  const playerNameInput = document.getElementById('player-name-input');
  const saveScoreBtn = document.getElementById('save-score-btn');

  // Shop upgrades
  const SHOP_UPGRADES = [
    {
      id: 'better_chance',
      name: 'Better Rare Chance',
      description: 'Increase chance to get Rare+ auras.',
      price: 500,
      purchased: false,
      effect: () => {
        // Increase weights of Rare+ categories, reduce Common to keep total weight same
        const common = CATEGORIES.find(c => c.name === 'Common');
        const rare = CATEGORIES.find(c => c.name === 'Rare');
        const epic = CATEGORIES.find(c => c.name === 'Epic');
        const legendary = CATEGORIES.find(c => c.name === 'Legendary');
        const mythic = CATEGORIES.find(c => c.name === 'Mythic');
        // Adjust weights
        if (!common) return;
        common.baseWeight = 30;
        if (rare) rare.baseWeight = 30;
        if (epic) epic.baseWeight = 20;
        if (legendary) legendary.baseWeight = 15;
        if (mythic) mythic.baseWeight = 5;
      }
    },
    {
      id: 'auto_generate',
      name: 'Auto Roll Aura',
      description: 'Automatically roll an aura every 10 seconds.',
      price: 1000,
      purchased: false,
      effect: () => {
        setupAutoRoll();
      }
    },
    {
      id: 'sell_bonus',
      name: 'Sell Bonus +20%',
      description: 'Get 20% more coins when selling auras.',
      price: 750,
      purchased: false,
      effect: () => {
        gameState.sellBonus = 0.2;
      }
    }
  ];

  // Game state
  let gameState = {
    coins: 0,
    inventory: {},      // { auraName: count }
    sellBonus: 0,
    totalCoinsEarned: 0,
    upgrades: {}
  };

  let leaderboard = [];

  // Render functions
  function renderCoins() {
    coinsDisplay.textContent = `Coins: ${gameState.coins}`;
  }

  function renderInventory() {
    const inv = gameState.inventory;
    if (Object.keys(inv).length === 0) {
      inventoryList.innerHTML = '<li style="text-align:center; color:#bbb;">No auras collected yet.</li>';
      sellSelectedBtn.disabled = true;
      return;
    }
    inventoryList.innerHTML = '';
    Object.entries(inv).forEach(([name, count]) => {
      const aura = getAuraByName(name);
      if (!aura) return;
      const li = document.createElement('li');
      li.className = 'category-' + aura.category.toLowerCase();

      // Checkbox for selecting to sell
      const checkbox = document.createElement('input');
      checkbox.type = 'checkbox';
      checkbox.dataset.name = name;
      checkbox.addEventListener('change', updateSellButton);
      li.appendChild(checkbox);

      const label = document.createElement('label');
      label.textContent = `${name} (x${count}) [${aura.category}] - ${aura.basePrice} coins each`;
      label.className = 'inventory-item-label category-' + aura.category.toLowerCase();
      li.appendChild(label);

      inventoryList.appendChild(li);
    });
    sellSelectedBtn.disabled = true;
  }

  function renderShop() {
    shopList.innerHTML = '';
    SHOP_UPGRADES.forEach(upg => {
      const li = document.createElement('li');
      li.className = 'shop-item';

      const info = document.createElement('div');
      info.innerHTML = `<strong>${upg.name}</strong> - ${upg.price} coins<br/><small>${upg.description}</small>`;
      li.appendChild(info);

      const btn = document.createElement('button');
      btn.textContent = upg.purchased ? 'Purchased' : 'Buy';
      btn.disabled = upg.purchased || gameState.coins < upg.price;
      btn.dataset.id = upg.id;
      li.appendChild(btn);

      shopList.appendChild(li);
    });
  }

  function renderLeaderboard() {
    if (leaderboard.length === 0) {
      leaderboardList.innerHTML = '<li style="text-align:center; color:#bbb;">No scores yet.</li>';
      return;
    }
    leaderboardList.innerHTML = '';
    leaderboard.forEach((entry, i) => {
      const li = document.createElement('li');
      li.textContent = `${i + 1}. ${entry.name} - ${entry.coins} coins`;
      leaderboardList.appendChild(li);
    });
  }

  // Helpers
  function updateSellButton() {
    const checked = inventoryList.querySelectorAll('input[type="checkbox"]:checked');
    sellSelectedBtn.disabled = checked.length === 0;
  }

  // Roll aura and display it
  function rollAura() {
    const aura = weightedRandomAura();
    showAura(aura);

    // Add to inventory
    const name = aura.name;
    gameState.inventory[name] = (gameState.inventory[name] || 0) + 1;
    saveGame();
    renderInventory();
  }

  // Show rolled aura
  function showAura(aura) {
    if (!aura) {
      auraDisplay.textContent = '-';
      auraCategoryEl.textContent = '';
      auraDisplay.className = 'aura-display';
      auraCategoryEl.className = 'aura-category';
      return;
    }
    auraDisplay.textContent = aura.name;
    auraCategoryEl.textContent = aura.category;
    auraDisplay.className = 'aura-display category-' + aura.category.toLowerCase();
    auraCategoryEl.className = 'aura-category category-' + aura.category.toLowerCase();
  }

  // Sell selected auras
  function sellSelectedAuras() {
    const checkedBoxes = inventoryList.querySelectorAll('input[type="checkbox"]:checked');
    if (checkedBoxes.length === 0) return;

    let totalEarned = 0;
    checkedBoxes.forEach(box => {
      const name = box.dataset.name;
      const aura = getAuraByName(name);
      if (!aura) return;
      const count = gameState.inventory[name];
      if (!count) return;
      const sellCount = 1; // one per checkbox checked? Actually all owned? We'll sell all count.
      // Sell all count of selected aura
      const earned = count * aura.basePrice * (1 + gameState.sellBonus);
      totalEarned += earned;
      delete gameState.inventory[name];
    });
    gameState.coins += Math.floor(totalEarned);
    gameState.totalCoinsEarned += Math.floor(totalEarned);
    saveGame();
    renderCoins();
    renderInventory();
  }

  // Buy upgrade
  function buyUpgrade(id) {
    const upgrade = SHOP_UPGRADES.find(u => u.id === id);
    if (!upgrade) return;
    if (upgrade.purchased) return;
    if (gameState.coins < upgrade.price) return;

    gameState.coins -= upgrade.price;
    upgrade.purchased = true;
    gameState.upgrades[id] = true;
    if (upgrade.effect) upgrade.effect();

    saveGame();
    renderCoins();
    renderShop();
  }

  // Auto roll setup
  let autoRollInterval = null;
  function setupAutoRoll() {
    if (autoRollInterval) clearInterval(autoRollInterval);
    if (gameState.upgrades['auto_generate']) {
      autoRollInterval = setInterval(() => {
        rollAura();
      }, 10000);
    }
  }

  // Save/load game and leaderboard
  function saveGame() {
    localStorage.setItem('rngGameState', JSON.stringify(gameState));
  }
  function loadGame() {
    const saved = localStorage.getItem('rngGameState');
    if (saved) {
      try {
        const data = JSON.parse(saved);
        if (data.coins != null) gameState.coins = data.coins;
        if (data.inventory) gameState.inventory = data.inventory;
        if (data.sellBonus != null) gameState.sellBonus = data.sellBonus;
        if (data.totalCoinsEarned != null) gameState.totalCoinsEarned = data.totalCoinsEarned;
        if (data.upgrades) {
          gameState.upgrades = data.upgrades;
          SHOP_UPGRADES.forEach(upg => {
            upg.purchased = !!gameState.upgrades[upg.id];
            if (upg.purchased && upg.effect) upg.effect();
          });
        }
      } catch {}
    }
  }
  function saveLeaderboard() {
    localStorage.setItem('rngGameLeaderboard', JSON.stringify(leaderboard));
  }
  function loadLeaderboard() {
    const saved = localStorage.getItem('rngGameLeaderboard');
    if (saved) {
      try {
        leaderboard = JSON.parse(saved);
      } catch { leaderboard = []; }
    }
  }

  // Save score with name
  function saveScore() {
    const name = playerNameInput.value.trim();
    if (!name) return alert('Enter your name!');
    if (gameState.totalCoinsEarned <= 0) return alert('You need to earn coins before saving your score!');

    const existing = leaderboard.find(e => e.name.toLowerCase() === name.toLowerCase());
    if (existing) {
      if (gameState.totalCoinsEarned > existing.coins) {
        existing.coins = gameState.totalCoinsEarned;
      }
    } else {
      leaderboard.push({ name, coins: gameState.totalCoinsEarned });
    }
    leaderboard.sort((a, b) => b.coins - a.coins);
    leaderboard = leaderboard.slice(0, 10);

    saveLeaderboard();
    renderLeaderboard();
    saveScoreBtn.disabled = true;
    alert('Score saved!');
  }

  // Enable save score button only when input valid
  function checkSaveButton() {
    const name = playerNameInput.value.trim();
    saveScoreBtn.disabled = !(name && gameState.totalCoinsEarned > 0);
  }

  // Event listeners
  rollBtn.addEventListener('click', () => {
    rollAura();
  });
  sellSelectedBtn.addEventListener('click', () => {
    sellSelectedAuras();
  });
  shopList.addEventListener('click', e => {
    if (e.target.tagName === 'BUTTON' && !e.target.disabled) {
      buyUpgrade(e.target.dataset.id);
    }
  });
  saveScoreBtn.addEventListener('click', saveScore);
  playerNameInput.addEventListener('input', checkSaveButton);
  inventoryList.addEventListener('change', updateSellButton);

  // Initialize
  loadGame();
  loadLeaderboard();
  renderCoins();
  renderInventory();
  renderShop();
  renderLeaderboard();
  setupAutoRoll();
  showAura(null);
  checkSaveButton();
})();
</script>

</body>
</html>
