<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Aura RNG Game</title>
  <style>
    body { font-family: sans-serif; text-align: center; margin-top: 50px; }
    #rollBtn[disabled] { opacity: 0.5; cursor: not-allowed; }
    .aura { font-weight: bold; }
    #leaderboard { margin-top: 20px; }
    .dev-mode { color: red; font-weight: bold; }
  </style>
</head>
<body>
  <h1>Aura RNG Game</h1>

  <div id="nameInputDiv">
    <input id="playerName" placeholder="Enter unique name" />
    <button onclick="startGame()">Start</button>
  </div>

  <div id="game" style="display: none;">
    <p id="auraDisplay">You have: <span class="aura" id="auraCount">0</span> auras</p>
    <button id="rollBtn" onclick="rollAura()">Roll Aura</button>
    <p id="lastAura"></p>
    <p id="devIndicator" class="dev-mode" style="display: none;">Developer Mode Active</p>
    <button onclick="enterDevMode()">Enter Dev Mode</button>
  </div>

  <div id="leaderboard">
    <h2>Leaderboard</h2>
    <ol id="leaderboardList"></ol>
  </div>

  <script>
    const auraTypes = [
      "Common", "Uncommon", "Rare", "Epic", "Legendary", "Mythic", "Celestial", "Corrupted"
    ];
    const auraChances = [40, 25, 15, 10, 5, 3, 1.5, 0.5]; // Must sum to 100%
    const cooldownTime = 3000; // 3 seconds
    const DEV_KEY = "d3v-2a9b91f4f3e048fa9bcdab1a7f4f"; // Secure dev key

    let auraCount = 0;
    let isDev = false;
    let playerName = "";

    function startGame() {
      const nameInput = document.getElementById("playerName").value.trim();
      if (!nameInput) {
        alert("Name cannot be empty.");
        return;
      }

      const leaderboard = getLeaderboard();
      if (leaderboard.some(player => player.name.toLowerCase() === nameInput.toLowerCase())) {
        alert("Name already exists on the leaderboard. Choose a different name.");
        return;
      }

      playerName = nameInput;
      document.getElementById("nameInputDiv").style.display = "none";
      document.getElementById("game").style.display = "block";

      loadGame();
      updateDisplay();
    }

    function rollAura() {
      const rollBtn = document.getElementById("rollBtn");
      if (!isDev) {
        rollBtn.disabled = true;
        setTimeout(() => rollBtn.disabled = false, cooldownTime);
      }

      const aura = getRandomAura();
      auraCount += 1;

      document.getElementById("lastAura").textContent = `You rolled a ${aura} aura!`;
      updateDisplay();
      saveGame();
    }

    function getRandomAura() {
      let rand = Math.random() * 100;
      for (let i = 0; i < auraTypes.length; i++) {
        if (rand < auraChances[i]) {
          return auraTypes[i];
        }
        rand -= auraChances[i];
      }
      return auraTypes[0]; // fallback
    }

    function updateDisplay() {
      document.getElementById("auraCount").textContent = auraCount;
      updateLeaderboard();
    }

    function saveGame() {
      const data = {
        auraCount,
        playerName,
        isDev
      };
      localStorage.setItem("rngGameSave", JSON.stringify(data));

      const leaderboard = getLeaderboard();
      const existing = leaderboard.find(player => player.name.toLowerCase() === playerName.toLowerCase());
      if (existing) {
        existing.auras = Math.max(existing.auras, auraCount);
      } else {
        leaderboard.push({ name: playerName, auras: auraCount });
      }
      localStorage.setItem("rngLeaderboard", JSON.stringify(leaderboard));
    }

    function loadGame() {
      const saved = JSON.parse(localStorage.getItem("rngGameSave"));
      if (saved && saved.playerName === playerName) {
        auraCount = saved.auraCount || 0;
        isDev = saved.isDev || false;
        if (isDev) {
          document.getElementById("devIndicator").style.display = "block";
        }
      }
    }

    function getLeaderboard() {
      return JSON.parse(localStorage.getItem("rngLeaderboard") || "[]");
    }

    function updateLeaderboard() {
      const list = document.getElementById("leaderboardList");
      const data = getLeaderboard();
      data.sort((a, b) => b.auras - a.auras);

      list.innerHTML = "";
      data.forEach(player => {
        const item = document.createElement("li");
        item.textContent = `${player.name}: ${player.auras} auras`;
        list.appendChild(item);
      });
    }

    function enterDevMode() {
      const input = prompt("Enter developer key:");
      if (input === DEV_KEY) {
        isDev = true;
        document.getElementById("devIndicator").style.display = "block";
        alert("Developer mode enabled! Infinite rolls and bypass cooldown.");
        saveGame();
      } else {
        alert("Invalid developer key.");
      }
    }

    window.onload = updateLeaderboard;
  </script>
</body>
</html>
